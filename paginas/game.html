<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raket Race met Obstakels</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            height: 100vh;
            margin: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative;
        }

        .background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('ACHTER.jpg') no-repeat center center fixed;
            background-size: cover;
            z-index: -10;
        }

        nav {
            position: fixed;
            top: 10px;
            left: 10px;
            z-index: 1;
        }

        .clean-button {
            padding: 10px 20px;
            background-color: rgba(76, 175, 80, 0.8);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-size: 16px;
            border: none;
            cursor: pointer;
        }

        #gameCanvas {
            border: 1px solid white;
            background-color: rgba(255, 255, 255, 0.1);
            z-index: 1;
            padding: 0;
            margin: 0;
        }

        #scoreBoard {
            position: fixed;
            bottom: 10px;
            right: 10px;
            font-size: 20px;
            color: white;
        }

        #timer {
            position: fixed;
            top: 10px;
            right: 10px;
            font-size: 24px;
            color: white;
        }

        #winner {
            font-size: 24px;
            font-weight: bold;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            z-index: 2;
            text-align: center;
        }

        #restartButton {
            margin-top: 20px;
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            display: none;
            z-index: 1;
            position: fixed;
            bottom: 100px;
            right: 20px;
        }
    </style>
</head>
<body>
    <div class="background"></div>

    <nav>
        <a href="../index.html" class="clean-button">Go to Home</a>
    </nav>

    <p id="scoreBoard">Scorebord: Speler 1: 0 | Speler 2: 0</p>
    <p id="timer">Tijd: 0</p>
    <p id="winner"></p>
    <canvas id="gameCanvas" width="640" height="600"></canvas>
    <button id="restartButton" onclick="restartGame()">Start opnieuw</button>

    <script>
// Canvas setup
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

// Obstakels en timers
let timer = 0;
let scorePlayer1 = 0;
let scorePlayer2 = 0;
let obstacles = [];
let gameOver = false;
let keysPressed = {};
let timerInterval;

// Haal de geselecteerde raketten op uit localStorage
const player1Data = JSON.parse(localStorage.getItem('player1'));
const player2Data = JSON.parse(localStorage.getItem('player2'));

// Controleer of de raketten geladen zijn
if (!player1Data || !player2Data) {
   
    window.location.href = '/selectie.html'; // Terug naar de selectiescherm
}

// Spelersinstellingen
const player1Rocket = {
    image: new Image(),
    x: 100,
    y: canvas.height - 45,
    speed: player1Data.speed,
};
player1Rocket.image.src = player1Data.src;

const player2Rocket = {
    image: new Image(),
    x: 500,
    y: canvas.height - 45,
    speed: player2Data.speed,
};
player2Rocket.image.src = player2Data.src;

// Laad finishlijn afbeelding
const finishLineImage = new Image();
finishLineImage.src = 'finish.png';

// Obstakel generator
function generateObstacles() {
    obstacles = [];
    for (let i = 0; i < 5; i++) {
        let obstacle = {
            x: Math.random() * (canvas.width - 50),
            y: Math.random() * -300,
            width: 50,
            height: 50,
            speed: 1 + Math.random(),
            image: new Image(),
        };
        obstacle.image.src = `obstacle${(i % 3) + 1}.png`;
        obstacles.push(obstacle);
    }
}

// Obstakels tekenen
function drawObstacles() {
    obstacles.forEach(obstacle => {
        obstacle.y += obstacle.speed;
        if (obstacle.y > canvas.height) {
            obstacle.y = Math.random() * -200;
            obstacle.x = Math.random() * (canvas.width - obstacle.width);
        }
        ctx.drawImage(obstacle.image, obstacle.x, obstacle.y, obstacle.width, obstacle.height);
    });
}

// Teken de finishlijn
function drawFinishLine() {
    ctx.drawImage(finishLineImage, 0, 0, canvas.width, 20);
}

// Bewegingslogica
function handleMovement() {
    if (keysPressed['z']) player1Rocket.y -= player1Rocket.speed;
    if (keysPressed['s']) player1Rocket.y += player1Rocket.speed;
    if (keysPressed['q']) player1Rocket.x -= player1Rocket.speed;
    if (keysPressed['d']) player1Rocket.x += player1Rocket.speed;

    if (keysPressed['arrowup']) player2Rocket.y -= player2Rocket.speed;
    if (keysPressed['arrowdown']) player2Rocket.y += player2Rocket.speed;
    if (keysPressed['arrowleft']) player2Rocket.x -= player2Rocket.speed;
    if (keysPressed['arrowright']) player2Rocket.x += player2Rocket.speed;

    player1Rocket.x = Math.max(0, Math.min(player1Rocket.x, canvas.width - 30));
    player1Rocket.y = Math.max(0, Math.min(player1Rocket.y, canvas.height - 45));
    player2Rocket.x = Math.max(0, Math.min(player2Rocket.x, canvas.width - 30));
    player2Rocket.y = Math.max(0, Math.min(player2Rocket.y, canvas.height - 45));
}

// Controleer botsingen
function checkCollisions() {
    // Speler 1 obstakels
    obstacles.forEach(obstacle => {
        if (player1Rocket.x < obstacle.x + obstacle.width &&
            player1Rocket.x + 30 > obstacle.x &&
            player1Rocket.y < obstacle.y + obstacle.height &&
            player1Rocket.y + 45 > obstacle.y) {
            // Speler 1 raakt een obstakel
            scorePlayer1 = 0; // Geen punten voor obstakel
            player1Rocket.image.src = ''; // Verwijder de raket van het scherm
            
        }
    });

    // Speler 2 obstakels
    obstacles.forEach(obstacle => {
        if (player2Rocket.x < obstacle.x + obstacle.width &&
            player2Rocket.x + 30 > obstacle.x &&
            player2Rocket.y < obstacle.y + obstacle.height &&
            player2Rocket.y + 45 > obstacle.y) {
            // Speler 2 raakt een obstakel
            scorePlayer2 = 0; // Geen punten voor obstakel
            player2Rocket.image.src = ''; // Verwijder de raket van het scherm
            
        }
    });
}

// Controleer winnaar
function checkWinner() {
    // Als een van de spelers de finish bereikt heeft en de andere nog niet
    if (player1Rocket.y <= 0 && player2Rocket.y <= 0 && !gameOver) {
        gameOver = true;
        scorePlayer1 = Math.round(1 / timer * 1000); // Speler 1 wint, score gebaseerd op tijd
        scorePlayer2 = Math.round(1 / timer * 1000); // Speler 2 wint, score gebaseerd op tijd
        document.getElementById("winner").innerText = `Beide spelers hebben de finish bereikt!\nSpeler 1: ${scorePlayer1} punten\nSpeler 2: ${scorePlayer2} punten`;
        document.getElementById("restartButton").style.display = "block";
    } else if (player1Rocket.y <= 0 && !gameOver) {
        gameOver = true;
        scorePlayer1 = Math.round(1 / timer * 1000); // Speler 1 wint, score gebaseerd op tijd
        document.getElementById("winner").innerText = `Speler 1 wint!\nSpeler 1: ${scorePlayer1} punten`;
        document.getElementById("restartButton").style.display = "block";
    } else if (player2Rocket.y <= 0 && !gameOver) {
        gameOver = true;
        scorePlayer2 = Math.round(1 / timer * 1000); // Speler 2 wint, score gebaseerd op tijd
        document.getElementById("winner").innerText = `Speler 2 wint!\nSpeler 2: ${scorePlayer2} punten`;
        document.getElementById("restartButton").style.display = "block";
    }
}

// Spel loop
function gameLoop() {
    if (!gameOver) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawFinishLine();
        ctx.drawImage(player1Rocket.image, player1Rocket.x, player1Rocket.y, 30, 45);
        ctx.drawImage(player2Rocket.image, player2Rocket.x, player2Rocket.y, 30, 45);
        drawObstacles();
        handleMovement();
        checkCollisions();
        checkWinner();
        updateScoreBoard();
        requestAnimationFrame(gameLoop);
    }
}

// Timer updaten
function updateTimer() {
    timer++;
    document.getElementById("timer").innerText = `Tijd: ${timer}`;
}

// Scorebord updaten
function updateScoreBoard() {
    document.getElementById("scoreBoard").innerText = `Scorebord: Speler 1: ${scorePlayer1} | Speler 2: ${scorePlayer2}`;
}

// Restart het spel
function restartGame() {
    window.location.reload();
}

// Start het spel
function startGame() {
    generateObstacles();
    timerInterval = setInterval(updateTimer, 1000);
    gameLoop();
}

// Key listeners
window.addEventListener('keydown', e => keysPressed[e.key.toLowerCase()] = true);
window.addEventListener('keyup', e => delete keysPressed[e.key.toLowerCase()]);

// Start het spel
startGame();

    </script>
</body>
</html>